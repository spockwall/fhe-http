# FHE-HTTP-JS

## Introduce
- This project offers a JavaScript interface for using [tfhe-rs](https://github.com/zama-ai/tfhe-rs). Additionally, a zk-experimental version is supported, enabling the server to verify encrypted values before computation begins, and assembly code execution allows clients to define the computation process/
- Currently, gpu acceleration of tfhe-rs is not yet available in this project.
- This package can only be run on `Node.js`.

## Required
- `Node.js^16`


## How to use
### Run Tests
#### Execute tests in __tests__
```
$ cd fhe-http/fhe_http_js
$ npm install
$ npm run build
$ npm run test-js
```
#### Test packaging at local
```shellscript=
$ cd fhe-http/fhe_http_js
$ npm install
$ npm run build
$ npm link

// change to 
$ cd <nodejs project path>
$ npm link fhe_http_js

// do something here ... 
```

## Details of usage
### #Basic Fhe Computation
#### Description
This basic version of FHE computation enables clients to delegate computation tasks to servers. Clients use a client key which is generated by themselves to encrypt the values. After encryption, clients send the encrypted values and a server key to the servers. Once the server key is received and set by the servers, the servers can execute the FHE computation on the ciphertexts. The computation result remains encrypted and is supposed to be sent back to the clients, who can then decrypt it to obtain the result in plaintext.

#### Supported
- operations: 
  - `add`, `sub`, `mul`, `div`, `rem`, `and`, `or`, `xor`, `shr`, `shl`, `not`, `and`, `neg`
- FheType: 
  - `Int64`
  - `Uint64`

#### Example usage
```javascript=
const fhe_http = require("fhe_http_js");

const keyGen = new fhe_http.KeyGen();
const fhe = new fhe_http.Fhe();
const fhe_ops = new fhe_http.FheOps();
const serializer = new fhe_http.Serializer();

let config = keyGen.createConfig();
let clientKey = keyGen.generateClientKey(config);
let serverKey = keyGen.generateServerKey(clientKey);
fhe_http.set_server_key(serverKey);
let cases = [
    { a: 123, b: 24 },
    { a: -123, b: -24 },
    { a: 2147483647, b: -12324 },
];
for (let i = 0; i < cases.length; i++) {
    let plaintext_a = serializer.fromI64(cases[i]["a"]);
    let plaintext_b = serializer.fromI64(cases[i]["b"]);
    let encrypted_a = fhe.encrypt(plaintext_a, clientKey, "Int64");
    let encrypted_b = fhe.encrypt(plaintext_b, clientKey, "Int64");
    let encrypted_res = fhe_ops.add(encrypted_a, encrypted_b, "Int64");
    let decrypted_res = fhe.decrypt(encrypted_res, clientKey, "Int64");
    let res = serializer.toI64(decrypted_res);
    console.log(res);
}

```